/*! videojs-ooyala - v0.1.0 - 2015-10-01 */
!function(a){var b={mp4:"video/mp4",flv:"video/flv",hls:"application/x-mpegURL",f4m:"application/adobe-f4m"},c={EXPIRED:5,GEO_BLOCKED:3},d={sasUrl:"//player.ooyala.com/sas/player_api/v1/authorization/embed_code/",metaDataUrl:"//player.ooyala.com/player_api/v1/metadata/embed_code/",errors:{MEDIA_ERR_OOYALA_EXPIRED:{code:"MEDIA_ERR_OOYALA_EXPIRED",headline:"Sorry, this video is no longer available",message:""},MEDIA_ERR_OOYALA_BLOCKED:{code:"MEDIA_ERR_OOYALA_BLOCKED",headline:"Sorry, this video is not available in your region",message:""},MEDIA_ERR_OOYALA:{code:"MEDIA_ERR_OOYALA",headline:"Sorry, this video is no longer available",message:""},MEDIA_ERR_NO_FLASH:{code:"MEDIA_ERR_NO_FLASH",headline:"This content requires the Adobe Flash plugin",message:'To play this content please download it at <a target="_blank" href="https://get.adobe.com/flashplayer/">https://get.adobe.com/flashplayer/</a>'}}},e=function(a,b){var c=Object.keys(b).map(function(a){return a+"="+b[a]}).join("&");return a+"?"+c},f=function(){return/MSIE 9/i.test(navigator.userAgent)},g=function(a){return/mp4/i.test(a)},h=function(a){return/\.flv$/i.test(a)},i=function(a){return/\.f4m/i.test(a)},j=function(a){return/\.m3u8$/i.test(a)},k=function(){return a.Hls&&a.Hls.supportsNativeHls},l=function(a,b){return g(a)&&(j(b)||i(b))?!0:!1},m=function(a){var b=[];return f()?b.push("hls"):(a.hls||k())&&b.push("m3u8"),b.push("mp4"),b},n=function(a,b){var d,e=parseInt(a,10);switch(e){case c.EXPIRED:d=b.errors.MEDIA_ERR_OOYALA_EXPIRED;break;case c.GEO_BLOCKED:d=b.errors.MEDIA_ERR_OOYALA_BLOCKED;break;default:d=b.errors.MEDIA_ERR_OOYALA,d.code=d.code+"_"+a}return d},o=function(a,b,c){var d={device:"html5",domain:window.location.hostname,supportedFormats:m(a),_:(new Date).getTime()},f=b.sasUrl+b.pcode+"/"+c,g=e(f,d);return g},p=function(a){var c=[];return Object.keys(a).map(function(d){var e=a[d];if(!e.authorized)return void(c[d]={authorized:!1,message:e.message,code:e.code});var i,k,l=e.streams[0],m=l.delivery_type;i=window.atob(l.url.data),i=i.replace(/^(http:|https:)/,""),i=window.location.protocol+i,k=b.mp4,g(m)?(k=b.mp4,i=i.replace("https","http")):h(i)?k=b.flv:f()?k=b.f4m:j(i)&&(k=b.hls),c[d]={authorized:e.authorized,type:k,src:i}}),c},q=function(b){var c=a.util.mergeOptions(d,b),f=this;return c.pcode?c.playerBrandingId?(f.ooyala.getVideoSource=function(b,d){if(!b)return d&&d("Missing embedCodes to load through Ooyala Plugin",null),!1;var e=o(f,c,b);a.xhr(e,function(a,b,c){var e=JSON.parse(c),f=e.authorization_data,g=p(f);if(d){var h={apiResponse:e,videoUrls:g};d(null,h)}})},f.ooyala.getMetadata=function(b,d){if(!b)return d&&d("Missing embedCodes to load through Ooyala Plugin",null),!1;var f=c.metaDataUrl+c.playerBrandingId+"/"+b;f=e(f,{videoPcode:c.pcode}),a.xhr(f,function(a,b,c){var e,f=JSON.parse(c);if(f&&f.errors&&f.errors.code)return d&&d(f.errors.message,null),!1;var e=f&&f.metadata&&f.metadata,g={};Object.keys(e).map(function(a){g[a]=e[a].base}),d&&d(null,g)})},void(f.ooyala.setSource=function(a,b){return a?void f.ooyala.getVideoSource(a,function(d,e){if(e&&e.videoUrls&&e.videoUrls[a]){var g=e.videoUrls[a];if("undefined"==typeof g.authorized||g.authorized)if(l(g.type,g.src)){var h=c.errors.MEDIA_ERR_NO_FLASH;f.error({code:h.code,headline:h.headline,message:h.message})}else f.error(null),f.src({type:g.type,src:g.src});else{var h=n(g.code,c);f.error({code:h.code,headline:h.headline,message:h.message})}}b&&b(null,e)}):(b&&b("Missing embedCode to set source",null),!1)})):a.log.error("Missing Ooyala playerBrandingId"):a.log.error("Missing Ooyala provider code")};a.plugin("ooyala",q)}(window.videojs);