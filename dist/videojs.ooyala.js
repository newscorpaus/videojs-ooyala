/*! videojs-ooyala - v0.4.1 - 2016-07-20 */
!function(a){var b={mp4:"video/mp4",flv:"video/flv",hls:"application/x-mpegURL"},c=a.mergeOptions?a.mergeOptions:a.util.mergeOptions,d={EXPIRED:5,GEO_BLOCKED:3},e={sasUrl:"//player.ooyala.com/sas/player_api/v1/authorization/embed_code/",metaDataUrl:"//player.ooyala.com/player_api/v1/metadata/embed_code/",errors:{MEDIA_ERR_OOYALA_EXPIRED:{code:"MEDIA_ERR_OOYALA_EXPIRED",headline:"Sorry, this video is no longer available",message:""},MEDIA_ERR_OOYALA_BLOCKED:{code:"MEDIA_ERR_OOYALA_BLOCKED",headline:"Sorry, this video is not available in your region",message:""},MEDIA_ERR_OOYALA:{code:"MEDIA_ERR_OOYALA",headline:"Sorry, this video is no longer available",message:""},MEDIA_ERR_NO_FLASH:{code:"MEDIA_ERR_NO_FLASH",headline:"This content requires the Adobe Flash plugin",message:'To play this content please download it at <a target="_blank" href="https://get.adobe.com/flashplayer/">https://get.adobe.com/flashplayer/</a>'},MEDIA_ERR_XHR_TIMEOUT:{code:"MEDIA_ERR_XHR_TIMEOUT",headline:"The video connection was lost",message:"Please check your internet connection and try again"},MEDIA_ERR_XHR_PARSE_FAILED:{code:"MEDIA_ERR_XHR_PARSE_FAILED",headline:"The video connection was lost",message:"Please check your internet connection and try again"},MISSING_OOYALA_VIDEO_ID:{code:"MISSING_OOYALA_VIDEO_ID",headline:"",message:"Missing ooyala video ID to load through Ooyala Plugin"}},enableHls:!1,maxXhrAttempts:3,xhrTimeout:45e3},f=function(a,b){var c=Object.keys(b).map(function(a){return a+"="+b[a]}).join("&");return a+"?"+c},g=function(a){return/mp4/i.test(a)},h=function(a){return/\.flv$/i.test(a)},i=function(a){return/\.m3u8$/i.test(a)},j=function(){var a=document.createElement("video");if(!window.videojs.getComponent("Html5").isSupported())return!1;for(var b=["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"],c=0;c<b.length;c++){var d=b[c];if(/maybe|probably/i.test(a.canPlayType(d)))return!0}return!1},k=function(){return j()||a.Flash.isSupported()},l=function(a,b){var c=[];return(a.hls||j()||b.enableHls)&&c.push("m3u8"),c.push("mp4"),c},m=function(b){return b.mobileProfile&&(a.IS_IOS||a.IS_ANDROID)?b.mobileProfile:null},n=function(a,b){var c,e=parseInt(a,10);switch(e){case d.EXPIRED:c=b.errors.MEDIA_ERR_OOYALA_EXPIRED;break;case d.GEO_BLOCKED:c=b.errors.MEDIA_ERR_OOYALA_BLOCKED;break;default:c=b.errors.MEDIA_ERR_OOYALA,c.code=c.code+"_"+a}return c},o=function(a,b,c){var d={device:"generic",domain:window.location.hostname,supportedFormats:l(a,b),_:(new Date).getTime()},e=m(b);e&&(d.profiles=e);var g=b.sasUrl+b.pcode+"/"+c,h=f(g,d);return h},p=function(a){var d=[];return Object.keys(a).map(function(e){var f=a[e];if(!f.authorized)return void(d[e]={authorized:!1,message:f.message,code:f.code});var j,k,l=f.streams[0],m=l.delivery_type;j=window.atob(l.url.data),j=j.replace(/^(http:|https:)/,""),j=window.location.protocol+j,k=b.mp4,g(m)?(k=b.mp4,j=j.replace("https","http")):h(j)?k=b.flv:i(j)&&(k=b.hls),d[e]=c(l,{authorized:f.authorized,type:k,src:j})}),d},q=function(b){var d=c(e,b),g=this;return d.pcode?d.playerBrandingId?(g.ooyala.getVideoSource=function(b,c){if(!b)return c&&c(d.errors.MISSING_OOYALA_VIDEO_ID,null),!1;var e={uri:o(g,d,b),timeout:d.xhrTimeout},f=0,h=function(b,g,i){var j;if(b||!i)return f++,f<=d.maxXhrAttempts?window.setTimeout(function(){f++,a.xhr(e,h)},500):c(d.errors.MEDIA_ERR_XHR_TIMEOUT,null),!1;try{j=JSON.parse(i)}catch(k){return f++,f<=d.maxXhrAttempts?a.xhr(e,h):c(d.errors.MEDIA_ERR_XHR_PARSE_FAILED,null),!1}var l=j.authorization_data,m=p(l);if(c){var n={apiResponse:j,videoUrls:m};c(null,n)}};a.xhr(e,h)},g.ooyala.getMetadata=function(b,c){if(!b)return c&&c(d.errors.MISSING_OOYALA_VIDEO_ID,null),!1;var e=d.metaDataUrl+d.playerBrandingId+"/"+b;e=f(e,{videoPcode:d.pcode}),a.xhr(e,function(a,b,d){var e,f=JSON.parse(d);if(f&&f.errors&&f.errors.code)return c&&c(f.errors.message,null),!1;var e=f&&f.metadata&&f.metadata,g={};Object.keys(e).map(function(a){g[a]=e[a].base}),c&&c(null,g)})},g.ooyala.prepareSettingSource=function(a,b,c){if(b&&b.videoUrls&&b.videoUrls[a]){var e=b.videoUrls[a];if("undefined"==typeof e.authorized||e.authorized)i(e.src)&&!k()?c(d.errors.MEDIA_ERR_NO_FLASH,b):(g.error(null),c(null,b));else{var f=n(e.code,d);c(f,b)}}},void(g.ooyala.setSource=function(a,b){return a?void g.ooyala.getVideoSource(a,function(c,d){return c?b(c,null):void g.ooyala.prepareSettingSource(a,d,function(a,c){c&&g.src({type:c.type,src:c.src}),b&&b(a,d)})}):(b&&b(d.errors.MISSING_OOYALA_VIDEO_ID,null),!1)})):a.log.error("Missing Ooyala playerBrandingId"):a.log.error("Missing Ooyala provider code")};a.plugin("ooyala",q)}(window.videojs);